# æ—¥å¿—é…ç½®

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [logging_config.py](file://src/sentientresearchagent/core/logging_config.py)
- [config.py](file://src/sentientresearchagent/config/config.py)
- [paths.py](file://src/sentientresearchagent/config/paths.py)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [æ—¥å¿—ç³»ç»Ÿæ¶æ„](#æ—¥å¿—ç³»ç»Ÿæ¶æ„)
3. [æ ¸å¿ƒé…ç½®è¯¦è§£](#æ ¸å¿ƒé…ç½®è¯¦è§£)
4. [æ—¥å¿—çº§åˆ«ä¸åº”ç”¨åœºæ™¯](#æ—¥å¿—çº§åˆ«ä¸åº”ç”¨åœºæ™¯)
5. [æ—¥å¿—æ ¼å¼ä¸å…³é”®å­—æ®µ](#æ—¥å¿—æ ¼å¼ä¸å…³é”®å­—æ®µ)
6. [å¤šå¤„ç†å™¨æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–](#å¤šå¤„ç†å™¨æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–)
7. [æ¨¡å—åŒ–æ—¥å¿—è®°å½•å™¨ä½¿ç”¨æŒ‡å—](#æ¨¡å—åŒ–æ—¥å¿—è®°å½•å™¨ä½¿ç”¨æŒ‡å—)
8. [æ—¥å¿—è½®è½¬ä¸ç£ç›˜ç®¡ç†](#æ—¥å¿—è½®è½¬ä¸ç£ç›˜ç®¡ç†)
9. [ç”Ÿäº§ç¯å¢ƒæ“ä½œå»ºè®®](#ç”Ÿäº§ç¯å¢ƒæ“ä½œå»ºè®®)
10. [é™„å½•ï¼šä¾¿æ·æ—¥å¿—å‡½æ•°](#é™„å½•ï¼šä¾¿æ·æ—¥å¿—å‡½æ•°)

## ç®€ä»‹
æœ¬é¡¹ç›®é‡‡ç”¨åŸºäºLoguruåº“æ„å»ºçš„å¢å¼ºå‹æ—¥å¿—ç³»ç»Ÿï¼Œé€šè¿‡å­—å…¸å¼é…ç½®å®ç°å¤šå¤„ç†å™¨è¾“å‡ºï¼ˆæ§åˆ¶å°ã€æ–‡ä»¶ï¼‰ï¼Œæ”¯æŒè‡ªå®šä¹‰æ—¥å¿—çº§åˆ«å’Œæ™ºèƒ½è¿‡æ»¤æœºåˆ¶ã€‚è¯¥ç³»ç»Ÿæ—¨åœ¨æä¾›æ¸…æ™°å¯è¯»çš„æ—¥å¿—è¾“å‡ºï¼Œç»“åˆä¸Šä¸‹æ–‡è¡¨æƒ…ç¬¦å·æå‡ä¿¡æ¯è¯†åˆ«æ•ˆç‡ï¼Œå¹¶ç¡®ä¿çº¿ç¨‹å®‰å…¨çš„å¼‚æ­¥å†™å…¥èƒ½åŠ›ã€‚

## æ—¥å¿—ç³»ç»Ÿæ¶æ„

```mermaid
graph TD
subgraph "æ—¥å¿—è¾“å…¥"
A[åº”ç”¨ä»£ç ] --> B[Loguru Logger]
end
subgraph "æ—¥å¿—å¤„ç†å™¨"
B --> C{æ˜¯å¦å¯ç”¨<br/>æ§åˆ¶å°è¾“å‡º?}
C --> |æ˜¯| D[Console Handler]
C --> |å¦| E[è·³è¿‡]
B --> F{æ˜¯å¦å¯ç”¨<br/>æ–‡ä»¶è®°å½•?}
F --> |æ˜¯| G[File Handler]
F --> |å¦| H[è·³è¿‡]
end
subgraph "è¾“å‡ºç›®æ ‡"
D --> I[æ ‡å‡†è¾“å‡º]
G --> J[æ—¥å¿—æ–‡ä»¶]
end
K[æ¨¡å—çº§è¿‡æ»¤å™¨] --> D
L[æ—¥å¿—è½®è½¬ç­–ç•¥] --> G
M[å‹ç¼©å½’æ¡£] --> G
```

**Diagram sources**
- [logging_config.py](file://src/sentientresearchagent/core/logging_config.py#L137-L217)
- [config.py](file://src/sentientresearchagent/config/config.py#L300-L327)

**Section sources**
- [logging_config.py](file://src/sentientresearchagent/core/logging_config.py#L1-L290)
- [config.py](file://src/sentientresearchagent/config/config.py#L300-L327)

## æ ¸å¿ƒé…ç½®è¯¦è§£

### é…ç½®ç»“æ„
æ—¥å¿—ç³»ç»Ÿç”±`LoggingConfig`ç±»é©±åŠ¨ï¼Œè¯¥ç±»å®šä¹‰äº†å®Œæ•´çš„æ—¥å¿—è¡Œä¸ºå‚æ•°ï¼š

```python
class LoggingConfig(BaseModel):
    level: str = "INFO"
    file_path: Optional[str] = None
    file_rotation: str = "10 MB"
    file_retention: int = 3
    enable_console: bool = True
    enable_file: bool = True
    module_levels: Optional[Dict[str, str]] = None
    console_style: str = "clean"
```

### é…ç½®é¡¹è¯´æ˜
- **level**: é»˜è®¤æ—¥å¿—çº§åˆ«ï¼Œæ”¯æŒTRACE/DEBUG/INFO/SUCCESS/WARNING/ERROR/CRITICAL
- **file_path**: è‡ªå®šä¹‰æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤ä¸º`runtime/logs/sentient.log`
- **file_rotation**: æ–‡ä»¶è½®è½¬å¤§å°é˜ˆå€¼ï¼Œé»˜è®¤10MB
- **file_retention**: ä¿ç•™å†å²æ—¥å¿—æ–‡ä»¶æ•°é‡ï¼Œé»˜è®¤3ä¸ª
- **enable_console/file**: æ§åˆ¶æ§åˆ¶å°ä¸æ–‡ä»¶è¾“å‡ºå¼€å…³
- **module_levels**: æ¨¡å—çº§æ—¥å¿—çº§åˆ«æ§åˆ¶æ˜ å°„è¡¨
- **console_style**: æ§åˆ¶å°æ˜¾ç¤ºé£æ ¼ï¼ˆclean/timestamp/detailedï¼‰

**Section sources**
- [config.py](file://src/sentientresearchagent/config/config.py#L300-L327)

## æ—¥å¿—çº§åˆ«ä¸åº”ç”¨åœºæ™¯

### å†…ç½®æ—¥å¿—çº§åˆ«
| æ—¥å¿—çº§åˆ« | åº”ç”¨åœºæ™¯ | è¾“å‡ºç¤ºä¾‹ |
|---------|--------|--------|
| DEBUG | è°ƒè¯•ä¿¡æ¯ï¼Œå¼€å‘é˜¶æ®µä½¿ç”¨ | `<dim>åŠ è½½ç¯å¢ƒå˜é‡...</dim>` |
| INFO | å¸¸è§„è¿è¡Œä¿¡æ¯ | `å¯åŠ¨æœåŠ¡å™¨...` |
| WARNING | è­¦å‘Šæƒ…å†µï¼Œä¸å½±å“ç»§ç»­è¿è¡Œ | `<yellow>ç¼“å­˜æœªå‘½ä¸­</yellow>` |
| ERROR | é”™è¯¯äº‹ä»¶ï¼ŒåŠŸèƒ½å—å½±å“ | `<red>æ•°æ®åº“è¿æ¥å¤±è´¥</red>` |
| CRITICAL | ä¸¥é‡é”™è¯¯ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºç»ˆæ­¢ | `<red>ç³»ç»Ÿæ— æ³•å¯åŠ¨</red>` |

### è‡ªå®šä¹‰æ—¥å¿—çº§åˆ«
ç³»ç»Ÿæ‰©å±•äº†ä¸¤ä¸ªä¸“ç”¨çº§åˆ«ï¼š
- **PLAN (è“è‰²)**: è§„åˆ’å†³ç­–è¿‡ç¨‹
- **EXECUTE (æ´‹çº¢è‰²)**: æ‰§è¡ŒåŠ¨ä½œè¿½è¸ª

è¿™äº›çº§åˆ«æœ‰åŠ©äºåŒºåˆ†æ™ºèƒ½ä½“çš„æ€è€ƒä¸æ‰§è¡Œé˜¶æ®µã€‚

**Section sources**
- [logging_config.py](file://src/sentientresearchagent/core/logging_config.py#L180-L198)
- [config.py](file://src/sentientresearchagent/config/config.py#L314-L318)

## æ—¥å¿—æ ¼å¼ä¸å…³é”®å­—æ®µ

### æ§åˆ¶å°è¾“å‡ºæ ¼å¼
æ ¹æ®`console_style`è®¾ç½®ä¸‰ç§æ¨¡å¼ï¼š
- **clean**: çº¯å‡€æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
- **timestamp**: åŒ…å«æ—¶é—´æˆ³
- **detailed**: è¯¦ç»†æ¨¡å¼å«æ¨¡å—ä¿¡æ¯

#### æ¸…æ´æ¨¡å¼ç¤ºä¾‹
```
ğŸš€ Starting server...
âœ… Server ready on port 8000
âš ï¸  Cache miss for query 'latest crypto trends'
âŒ Database connection failed
```

### æ–‡ä»¶è¾“å‡ºæ ¼å¼
æ–‡ä»¶æ—¥å¿—åŒ…å«å®Œæ•´ç»“æ„åŒ–ä¿¡æ¯ï¼š
```
2024-01-15 14:30:22.123 | INFO     | sentientresearchagent.server.main | start_server       | Starting server...
2024-01-15 14:30:22.456 | WARNING  | sentientresearchagent.core.cache_manager | get_cache          | Cache miss for key 'trend_analysis_001'
```

#### å­—æ®µè¯´æ˜
| å­—æ®µ | æè¿° |
|------|------|
| æ—¶é—´æˆ³ | ç²¾ç¡®åˆ°æ¯«ç§’çš„ISOæ ¼å¼æ—¶é—´ |
| æ—¥å¿—çº§åˆ« | å…«ä½å¯¹é½çš„çº§åˆ«æ ‡è¯† |
| æ¨¡å—å | å®Œæ•´çš„Pythonæ¨¡å—è·¯å¾„ |
| å‡½æ•°å | å‘ç”Ÿæ—¥å¿—è°ƒç”¨çš„å‡½æ•°åç§° |
| æ¶ˆæ¯å†…å®¹ | å®é™…æ—¥å¿—æ–‡æœ¬ |

**Section sources**
- [logging_config.py](file://src/sentientresearchagent/core/logging_config.py#L150-L155)
- [logging_config.py](file://src/sentientresearchagent/core/logging_config.py#L205-L212)

## å¤šå¤„ç†å™¨æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–

### åˆå§‹åŒ–æµç¨‹
```mermaid
flowchart TD
Start([å¼€å§‹]) --> RemoveExisting["ç§»é™¤ç°æœ‰å¤„ç†å™¨"]
RemoveExisting --> CheckConsole["æ£€æŸ¥æ˜¯å¦å¯ç”¨æ§åˆ¶å°"]
CheckConsole --> |æ˜¯| AddConsole["æ·»åŠ æ§åˆ¶å°å¤„ç†å™¨"]
CheckConsole --> |å¦| SkipConsole["è·³è¿‡"]
AddConsole --> CheckFile["æ£€æŸ¥æ˜¯å¦å¯ç”¨æ–‡ä»¶"]
SkipConsole --> CheckFile
CheckFile --> |æ˜¯| EnsureDir["ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨"]
CheckFile --> |å¦| SkipFile["è·³è¿‡"]
EnsureDir --> AddFile["æ·»åŠ æ–‡ä»¶å¤„ç†å™¨"]
AddFile --> AddCustomLevels["æ³¨å†Œè‡ªå®šä¹‰çº§åˆ«"]
SkipFile --> AddCustomLevels
AddCustomLevels --> LogSuccess["è®°å½•æˆåŠŸæ¶ˆæ¯"]
LogSuccess --> End([ç»“æŸ])
```

**Diagram sources**
- [logging_config.py](file://src/sentientresearchagent/core/logging_config.py#L137-L217)

**Section sources**
- [logging_config.py](file://src/sentientresearchagent/core/logging_config.py#L137-L217)

### åˆå§‹åŒ–ä»£ç è·¯å¾„
ç³»ç»Ÿé€šè¿‡`setup_logging()`å‡½æ•°å®Œæˆåˆå§‹åŒ–ï¼Œæ¥æ”¶`LoggingConfig`å®ä¾‹ä½œä¸ºå‚æ•°ï¼Œå¹¶å¯é€‰åœ°åº”ç”¨æ¨¡å—è¿‡æ»¤å™¨ã€‚

## æ¨¡å—åŒ–æ—¥å¿—è®°å½•å™¨ä½¿ç”¨æŒ‡å—

### è·å–å‘½åè®°å½•å™¨
å¼€å‘è€…åº”åœ¨å„æ¨¡å—ä¸­ä½¿ç”¨ç»Ÿä¸€æ–¹å¼è·å–è®°å½•å™¨ï¼š

```python
from loguru import logger

def my_module_function():
    logger.info("This is a standard info message")
```

### ä½¿ç”¨ä¾¿æ·å‡½æ•°
ç³»ç»Ÿæä¾›äº†ä¸€ç³»åˆ—è¯­ä¹‰åŒ–æ—¥å¿—å‡½æ•°ï¼š

```mermaid
classDiagram
class LogFunctions {
+log_start(message : str)
+log_success(message : str)
+log_plan(message : str)
+log_execute(message : str)
+log_node(node_id : str, message : str)
+log_agent(agent_name : str, message : str)
+log_hitl(message : str)
+log_websocket(event : str, message : str)
+log_section(title : str, char : str)
}
```

**Diagram sources**
- [logging_config.py](file://src/sentientresearchagent/core/logging_config.py#L220-L289)

**Section sources**
- [logging_config.py](file://src/sentientresearchagent/core/logging_config.py#L220-L289)

### æœ€ä½³å®è·µç¤ºä¾‹
```python
# åœ¨ä»»åŠ¡èŠ‚ç‚¹ä¸­
log_node("TASK-001", "å¼€å§‹æ•°æ®æ”¶é›†")

# åœ¨æ™ºèƒ½ä½“ä¸­
log_agent("ResearchAgent", "ç”Ÿæˆåˆæ­¥åˆ†ææŠ¥å‘Š")

# åœ¨äººæœºäº¤äº’ä¸­
log_hitl("ç­‰å¾…ç”¨æˆ·ç¡®è®¤æœç´¢æ–¹å‘")
```

## æ—¥å¿—è½®è½¬ä¸ç£ç›˜ç®¡ç†

### è½®è½¬ç­–ç•¥
- **è§¦å‘æ¡ä»¶**: å•ä¸ªæ—¥å¿—æ–‡ä»¶è¾¾åˆ°10MB
- **ä¿ç•™ç­–ç•¥**: æœ€å¤šä¿ç•™3ä¸ªå†å²æ–‡ä»¶
- **å‹ç¼©æ–¹å¼**: æ—§æ—¥å¿—è‡ªåŠ¨ZIPå‹ç¼©

### å­˜å‚¨ä½ç½®
æ—¥å¿—æ–‡ä»¶å­˜å‚¨äºæ ‡å‡†åŒ–è¿è¡Œæ—¶ç›®å½•ï¼š

```mermaid
erDiagram
RUNTIME_DIR ||--o{ LOGS_DIR : contains
RUNTIME_DIR {
string base_dir PK
}
LOGS_DIR {
string path PK
string description "åº”ç”¨å’Œæ‰§è¡Œæ—¥å¿—"
}
LOGS_DIR }|--o{ LOG_FILE : generates
LOG_FILE {
string name PK
string rotation_size "10 MB"
string retention_count "3"
string compression "zip"
}
```

**Diagram sources**
- [paths.py](file://src/sentientresearchagent/config/paths.py#L56-L58)
- [config.py](file://src/sentientresearchagent/config/config.py#L305-L307)

**Section sources**
- [paths.py](file://src/sentientresearchagent/config/paths.py#L26-L26)
- [config.py](file://src/sentientresearchagent/config/config.py#L306-L307)

## ç”Ÿäº§ç¯å¢ƒæ“ä½œå»ºè®®

### å®‰å…¨è°ƒæ•´æ—¥å¿—çº§åˆ«
åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åŠ¨æ€è°ƒæ•´æ—¥å¿—çº§åˆ«åº”éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„`level`å­—æ®µ
2. é‡å¯æœåŠ¡ä½¿å˜æ›´ç”Ÿæ•ˆ
3. æˆ–ä½¿ç”¨çƒ­é‡è½½æœºåˆ¶ï¼ˆå¦‚æ”¯æŒï¼‰

é¿å…åœ¨è¿è¡Œæ—¶ç›´æ¥ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œä»¥é˜²å½±å“æ€§èƒ½ã€‚

### æ€§èƒ½æ³¨æ„äº‹é¡¹
- **è¯Šæ–­ä¿¡æ¯**: ç”Ÿäº§ç¯å¢ƒä¸‹ç¦ç”¨`diagnose=True`ä»¥é˜²æ­¢æ•æ„Ÿæ•°æ®æ³„éœ²
- **çº¿ç¨‹å®‰å…¨**: æ‰€æœ‰æ—¥å¿—æ“ä½œå‡å¯ç”¨`enqueue=True`ä¿è¯çº¿ç¨‹å®‰å…¨
- **I/Oä¼˜åŒ–**: æ–‡ä»¶å†™å…¥é‡‡ç”¨å¼‚æ­¥é˜Ÿåˆ—å‡å°‘é˜»å¡

### è¿œç¨‹ä¼ è¾“æ‰©å±•
è™½ç„¶å½“å‰é…ç½®æœªç›´æ¥å®ç°è¿œç¨‹ä¼ è¾“ï¼Œä½†å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼æ‰©å±•ï¼š
- é…ç½®æ—¥å¿—èšåˆå·¥å…·ï¼ˆå¦‚Fluentdã€Logstashï¼‰ç›‘æ§æ—¥å¿—ç›®å½•
- ä½¿ç”¨å¤–éƒ¨è„šæœ¬å®šæœŸä¸Šä¼ å‹ç¼©æ—¥å¿—
- é›†æˆäº‘åŸç”Ÿæ—¥å¿—æœåŠ¡SDK

**Section sources**
- [logging_config.py](file://src/sentientresearchagent/core/logging_config.py#L208-L210)
- [logging_config.py](file://src/sentientresearchagent/core/logging_config.py#L167-L168)

## é™„å½•ï¼šä¾¿æ·æ—¥å¿—å‡½æ•°

### å‡½æ•°åˆ—è¡¨
| å‡½æ•°å | ç”¨é€” | ç¤ºä¾‹ |
|-------|------|------|
| `log_start()` | æ ‡è®°æµç¨‹å¯åŠ¨ | `log_start("æœåŠ¡å™¨")` |
| `log_success()` | æ ‡è®°æˆåŠŸå®Œæˆ | `log_success("é¡¹ç›®ä¿å­˜æˆåŠŸ")` |
| `log_plan()` | è®°å½•è§„åˆ’æ´»åŠ¨ | `log_plan("åˆ¶å®šç ”ç©¶è®¡åˆ’")` |
| `log_execute()` | è®°å½•æ‰§è¡ŒåŠ¨ä½œ | `log_execute("æ‰§è¡Œç½‘ç»œæœç´¢")` |
| `log_node()` | èŠ‚ç‚¹ç‰¹å®šæ—¥å¿— | `log_node("NODE-001", "çŠ¶æ€æ›´æ–°")` |
| `log_agent()` | æ™ºèƒ½ä½“ä¸“å±æ—¥å¿— | `log_agent("Analyzer", "å®Œæˆæ•°æ®åˆ†æ")` |
| `log_hitl()` | äººæœºäº¤äº’æ—¥å¿— | `log_hitl("è¯·æ±‚ç”¨æˆ·è¾“å…¥")` |
| `log_websocket()` | WebSocketäº‹ä»¶ | `log_websocket("connect", "å®¢æˆ·ç«¯æ¥å…¥")` |
| `log_section()` | åˆ†èŠ‚æ ‡é¢˜ | `log_section("åˆå§‹åŒ–é˜¶æ®µ")` |

è¿™äº›å‡½æ•°å°è£…äº†å¸¸è§çš„æ—¥å¿—æ¨¡å¼ï¼Œæé«˜äº†ä»£ç å¯è¯»æ€§å’Œä¸€è‡´æ€§ã€‚

**Section sources**
- [logging_config.py](file://src/sentientresearchagent/core/logging_config.py#L220-L289)